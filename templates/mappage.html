<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Mapbox Example</title>
    <link href='https://fonts.googleapis.com/css?family=Poppins' rel='stylesheet'>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.css' rel='stylesheet' />
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Poppins;
        }

       #loader {
  display: block;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 9999;
  background-color: #fff;
}

#loader:after {
  content: "";
  display: block;
  position: absolute;
  top: 50%;
  left: 50%;
  width: 60px;
  height: 60px;
  margin: -30px 0 0 -30px;
  border-radius: 50%;
  border: 6px solid #ccc;
  border-top-color: #000;
  animation: loader 1.5s infinite linear;
}

@keyframes loader {
  to { transform: rotate(360deg); }
}

         #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }

       #map .marker {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  background-size: cover;
  background-position: center;
  cursor: pointer;
  border: 2px solid white;
}
        #sidepanel {
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            width: 400px;
            background-color: white;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
            overflow: scroll;
            padding: 10px;
        }
  #sidepanel .city{
    font-weight: 700;
    font-size: 28px;
  }

  .cityname{
     font-weight: 600;
    font-size: 23px;
  }

  #sidepanel .views{
    font-size: 15px;
  }
   #sidepanel .title {
            font-weight: bold;
            color: #00008B;
            margin-top: 10px;
              font-size: 15px;
        }

         .container {
  background-color: #f5f0e4;
  padding: 10px;
  border-radius: 10px;
  margin-bottom: 20px;


}
tags-container {
  margin-top: 20px;
}


#tagsRow {
  display: flex;
  flex-wrap: nowrap;
  overflow-x: hidden;
}

#tagsRow.expanded {
  flex-wrap: wrap;
  overflow-x: auto;
}



#tagsRow .tag {
  display: inline-flex;
    flex: 0 0 auto;
  background-color: black;
  color: white;
  border-radius: 17px;
  padding: 5px 10px;
  margin-right: 6px;
  margin-bottom: 10px;
  font-size: 15px;
}
#tagsRow .tag.selected {
  background-color: salmon;
}
#tagsRow .filtertag{
  display: inline-flex;
    flex: 0 0 auto;
  background-color: red;
  color: white;
  border-radius: 10px;
  padding: 5px 10px;
  margin-right: 6px;
  margin-bottom: 10px;
}

#tagFilterInput {
  /* Add your desired styles here */
  width: 200px;
  height: 30px;
  padding: 5px;
  background-color:pink;
  border: 1px solid #ccc;
  border-radius: 5px;
  font-size: 14px;
}
#toggleButton {
  background-color:white;
  border-radius: 7px;
  border-top-color: black;
  width: 40px;
  height: 18px;
  font-size: 10px;
}
#tilesContainer {
  display: flex;
  flex-wrap: wrap;
  vertical-align: middle;
}

.tile {
  display: flex;
  flex-direction: inline-block;
  background-color:white;
  width: 100%;
  margin-top: 10px;
  border-radius: 5px;
  padding: 10px;
}

.tile img {
  width: 130px;
  height: 90px;
    margin-right: 10px;
  border-radius: 5px;
}

.tile h3 {
  font-size: 15px;
  margin-top: 5px;
  margin-bottom: 7px;
}

.tile .tags {
  display: flex;
  flex-wrap: wrap;castle
}


.tile .tile-content {
  flex: 1;
  flex-direction: column;
}
.tile .tags span {
  display: inline-block;
  background-color: black;
  color: white;
  font-size: 13px;
  padding: 3px 6px;
  margin-right: 5px;
  margin-bottom: 5px;
  border-radius: 17px;
}

 #sidebar {
            position: fixed;
            top: 0;
            right: 0;
            bottom: 0;
            width: 400px;
            background-color: white;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
            overflow: scroll;
            padding: 10px;
            visibility: hidden;
            opacity: 0;
            
        }



        #sidebar.active {
            visibility: visible;
            opacity: 1;
        }

        
        #sidebar h3 {
            font-weight: bold;
            margin-top: 35px;
            font-size: 23px;
        }

        #sidebar p {
            margin-top: 5px;
            
        }
        #tagsSidebarRow {
  display: flex;
  flex-wrap: nowrap;
  overflow-x: hidden;
}

#tagsSidebarRow .tag {
  display: inline-flex;
    flex: 0 0 auto;
  background-color: black;
  color: white;
  border-radius: 17px;
  font-size :15px;
  padding: 5px 10px;
  margin-right: 6px;
  margin-bottom: 10px;
}


    .sidebar-images {
      overflow-x: auto;
      white-space: nowrap;
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
    }

    .sidebar-images img {
      display: inline-block;
      width: 100px;
      height: 100px;
      margin-right: 10px;
    
      object-fit: cover;
    
    }

    .buttonRow{
      display: flex;
      flex-direction: inline-block;
    }


        #sidebar .text {
           
            
              font-size: 15px;
              font-weight: normal;
              color: black;
        }
        
        
        #sidebar .title {
            font-weight: bold;
            color: #00008B;
            margin-top: 10px;
              font-size: 18px;
        }

         #sidebar .description {
            height: 100px; /* set a fixed height for the element */
            overflow-y: scroll; /* enable vertical scrolling */
            position:relative;
            width:300px;
          }

        #sidebar button {
            margin-top: 10px;
            margin-right: 10px;
            border-radius: 15px;
            border-top-color: black;
            color: black;
            height: 33px;
            font-weight: bold;
            font-size: 15px;
            cursor: pointer;
            
        }
         .pubs-tiles-container {
      white-space: nowrap;
      overflow-x: auto;
      display: inline-block;
    }

    .pubs-tile {
  width: 180px;
  height: 110px;
  background-color: #e63946;
  border-radius: 15px;
  padding: 10px;
  margin: 10px;
  display: inline-block;
  cursor: pointer;
  overflow: hidden;
}

.pubs-tile .pubs-text {
  height: 100%;
  display: flex;
  flex-direction: column;
  justify-content: center;
  color: white;
}

.pubs-tile .pubs-text p {
  margin: 0;
  overflow: hidden;
  color: white;
  text-overflow: ellipsis;
  display: -webkit-box;
  -webkit-line-clamp: 3; /* Adjust the number of lines you want to show */
  -webkit-box-orient: vertical;
  word-wrap: break-word;
  white-space: normal;
}

}

        #sidebar .map-button {
            background-color: white;
        
            width: 100px;
          
        }

        #sidebar .call-button {
            background-color: white;
          
            width: 100px;
          
        }

        #sidebar .close-button {
               position: absolute;
          right: 10px;
  top: 10px;
          border-radius: 0px;
          background-color: #f5f0e4;
          color:black;
             border: solid black;
             margin-top:20px;
             margin-left:20px;
          width: 15px;
          height: 15px;
  border-width: 0 3px 3px 0;
  display: inline-block;
  padding: 3px;
  transform: rotate(135deg);
  -webkit-transform: rotate(135deg);
        }

        #back-button {
         
           background-color: transparent;
             border: solid black;
             margin-top:20px;
             margin-left:20px;
          width: 15px;
          height: 15px;
  border-width: 0 3px 3px 0;
  display: inline-block;
  padding: 3px;
  transform: rotate(135deg);
  -webkit-transform: rotate(135deg);
        }
        }

        #back-button.active {
            visibility: visible;
        }
    </style>
</head>
<body>
     
     
      <div id="loader"></div>
    <div id='map'></div>
    <div id='sidepanel'>
     <div class="container">
    <div id='city' class="cityname"></div>
    <div class='title'>Places: <span id='views'></span></div>
  </div>
  <div class="tags-container">
    <div id="tagsRow">
    </div>
    <button id="toggleButton">more</button>
    <div id="tilesContainer">
    </div>
  </div>
    </div>
    </div>
    <div id="sidebar">
      <div class="container">
<h3></h3>
  </div>
        
        <div id="tagsSidebarRow">
           <div class='tag'>tag 1</div>
        </div>
        <div class="buttonRow">
        <button class="map-button">Map</button>
        <button class="call-button">Call</button>
        </div>
        <p class="title">Description: <span class="text" id="description"></span></p>
        <p class="title">Rating: <span class="text" id="rating"></span></p>
        <p class="title">Address: <span class="text" id="address"></span></p>
        <p class="title">Opening Hours: <span class="text" id="opening-hours"></span></p>
        <div class="sidebar-images"></div>
        <p class="title">Featured In<p>
      <div class="pubs-tiles-container" id="pubs-tiles-container">
      </div>
        <button class="close-button"></button>
    </div>
    <form method="POST" action="/">
    <button id="back-button"></button>
       
    <script>
      
        mapboxgl.accessToken = 'pk.eyJ1IjoiYWF5dXNoZG9zaGkiLCJhIjoiY2xnZzdrYmRzMDhzbTNkcG5zOGszMjRzMyJ9.1Ljn54UqJ-EYlQBh1HWU8g';

        var places = {{ places_json|safe }};
        var city = '{{city_name}}'
        var map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v11',
            center: [places[0].Longitude, places[0].Latitude],
            zoom: 12
        });

        var markers = createMarkers(places);

        function createMarkers(places) {
  var markers = places.map(function(place) {
    var popupContent = "<h3>" + place.Name + "</h3>"
      + "<p>Description: " + place.Description + "</p>"
      + "<p>Tags: " + place.Tags + "</p>"
      + "<p>Rating: " + place.Rating + "</p>"
      + "<p>Address: " + place.Address + "</p>"
      + "<p>Opening Hours: " + place["Opening Hours"] + "</p>";

    var el = document.createElement('div');
    el.className = 'marker';
    el.style.backgroundImage = 'url(' + place.Photos[0] + ')';

    var marker = new mapboxgl.Marker({
      element: el
    }).setLngLat([place.Longitude, place.Latitude])
      .addTo(map)
      .getElement();

   marker.addEventListener('click', function() {
      showSidebar(place);
    });

    return marker;
  });

  return markers;
}
var tagsSidebarRow = document.getElementById('tagsSidebarRow');
function createSidebarTagElement(tagValue) {
  var tagElement = document.createElement('div');
  tagElement.classList.add('tag');
  tagElement.textContent = tagValue;
  return tagElement;
}

function populateSidebarTags(tags) {
  tagsSidebarRow.innerHTML = ''; // Clear existing tags

  tags.forEach(function(tag) {
    var tagElement = createSidebarTagElement(tag);
    tagsSidebarRow.appendChild(tagElement);
  });
}

function showSidebar(place) {
  var sidebar = document.getElementById('sidebar');
  var backButton = document.getElementById('back-button');
  var closeButton = document.querySelector('.close-button');
  var mapButton = document.querySelector('.map-button');
  var callButton = document.querySelector('.call-button');
  var dictionaryList = place.Publications;

  sidebar.classList.add('active');

  mapButton.onclick = function() {
    var googleMapsUrl = 'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(place.Name + ' ' + place.Address);
    window.open(googleMapsUrl, '_blank');
  };

  if (place.Phone) {
    callButton.style.display = 'block';
    callButton.onclick = function() {
      if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
        window.location.href = 'tel:' + place.Phone;
      } else {
        window.open('tel:' + place.Phone);
      }
    };
  } else {
    callButton.style.display = 'none';
  }

  backButton.onclick = function() {
    sidebar.classList.remove('active');
  };

  closeButton.onclick = function() {
    sidebar.classList.remove('active');
  };

  document.querySelector('#sidebar h3').innerHTML = place.Name;
  document.querySelector('#sidebar #description').innerHTML = place.Description;
  document.querySelector('#sidebar #rating').innerHTML = place.Rating;
  document.querySelector('#sidebar #address').innerHTML = place.Address;
  document.querySelector('#sidebar #opening-hours').innerHTML = place['Opening Hours'];
   populateSidebarTags(place.Tags)
  const sidebarImagesContainer = document.querySelector('#sidebar .sidebar-images');
  const imageList = document.createElement('ul');
  imageList.classList.add('sidebar-image-list');

  for (var j = 0; j < place.Photos.length; j++) {
    const img = document.createElement('img');
    img.src = place.Photos[j];
    img.alt = place.Name;
    img.width = 100;
    img.height = 100;
    img.classList.add('sidebar-image');

    const imageListItem = document.createElement('li');
    imageListItem.appendChild(img);
    imageList.appendChild(imageListItem);
  }

  if (sidebarImagesContainer.firstChild) {
    sidebarImagesContainer.replaceChild(imageList, sidebarImagesContainer.firstChild);
  } else {
    sidebarImagesContainer.appendChild(imageList);
  }


  // Create tiles from the dictionary list
     var tilesContainer = document.getElementById("pubs-tiles-container");
     const tileList = document.createElement('tl');
     tileList.classList.add('sidebar-tile-list');
    for (var i = 0; i < dictionaryList.length; i++) {
      var dictionary = dictionaryList[i];

      var tile = document.createElement("div");
      tile.className = "pubs-tile";
      var text = document.createElement('div');
      text.className = 'pubs-text';
      var para = document.createElement('p');
      para.innerText = dictionary.text;
      text.appendChild(para);
      tile.appendChild(text);
      tile.addEventListener('click', function() {
    
      window.open(dictionary.link, '_blank');
  
  });
      const tileListItem = document.createElement('ti');
    tileListItem.appendChild(tile);
    tileList.appendChild(tileListItem);
    }

    if (tilesContainer.firstChild) {
    tilesContainer.replaceChild(tileList, tilesContainer.firstChild);
  } else {
    tilesContainer.appendChild(tileList);
  }



    // Function to open the link
    function openLink(link) {
      window.open(link, "_blank");
    }

}

 var list = [];





//Creating tags
        function calculateNumberOfPlaces(places) {
    return places.length;
        }

      function getAllTags(places) {
          var allTags = [];
          places.forEach(function(place) {
              allTags = allTags.concat(place.Tags);
          });

          // Remove duplicates and return unique tags
          return Array.from(new Set(allTags));
      }
      var numberOfPlaces = calculateNumberOfPlaces(places);
      document.querySelector('#sidepanel #city').innerHTML = city;
  document.querySelector('#sidepanel #views').innerHTML = numberOfPlaces;
      var tagValues = getAllTags(places); // Assuming `getAllTags` function returns an array of tags
      var tagsRow = document.getElementById('tagsRow');

function createTagElement(tagValue) {
  var tagElement = document.createElement('div');
  tagElement.classList.add('tag');
  tagElement.textContent = tagValue;
  // Add a click event listener to each tag element
  tagElement.addEventListener('click', function() {
    tagElement.classList.toggle('selected');
  
    if (list.includes(tagValue)) {
      // Remove tagValue from the list
      var index = list.indexOf(tagValue);
      if (index !== -1) {
        list.splice(index, 1);
      }
    } else {
      // Add tagValue to the list
      list.push(tagValue);
    }
    if (list.length == 0){
      populateTiles(places);
    }
    else{
       filterTiles(list);
    }
   
    

  });

  return tagElement;
}

function populateTags(tags) {
  tagsRow.innerHTML = ''; // Clear existing tags

  tags.forEach(function(tag) {
    var tagElement = createTagElement(tag);
    tagsRow.appendChild(tagElement);
  });
}
populateTags(tagValues)

 
      //tags expansion button
      var tagsRow = document.getElementById('tagsRow');
var toggleButton = document.getElementById('toggleButton');

toggleButton.addEventListener('click', function() {
  tagsRow.classList.toggle('expanded');
});



      //tiles on side-panel
     function createTileElement(place) {
  var tileElement = document.createElement('div');
  tileElement.classList.add('tile');

  var imageElement = document.createElement('img');
  imageElement.src = place.Photos[0];
  imageElement.alt = place.Name;
  tileElement.appendChild(imageElement);

  var contentElement = document.createElement('div');
  contentElement.classList.add('tile-content');

  var nameElement = document.createElement('h3');
  nameElement.textContent = place.Name;
  contentElement.appendChild(nameElement);

  var tagsElement = document.createElement('div');
  tagsElement.classList.add('tags');
  place.Tags.forEach(function(tag) {
    var tagElement = document.createElement('span');
    tagElement.textContent = tag;
    tagsElement.appendChild(tagElement);
  });
  contentElement.appendChild(tagsElement);

  tileElement.appendChild(contentElement);
  tileElement.addEventListener('click', function() {
    
      showSidebar(place);
  
  });
  

  return tileElement;
}


function populateTiles(places) {
  tilesContainer.innerHTML = ''; // Clear existing tiles

  places.forEach(function(place) {
    var tileElement = createTileElement(place);
    tilesContainer.appendChild(tileElement);
  });
}

populateTiles(places);

function filterTiles(inputList) {
  var tiles = document.getElementsByClassName('tile');
  for (var i = 0; i < tiles.length; i++) {
    var tile = tiles[i];
    var tagsElement = tile.querySelector('.tags');
    var tags = tagsElement.querySelectorAll('span');

    var isMatch = false;
    for (var j = 0; j < tags.length; j++) {
      var tag = tags[j];
      var tagName = tag.textContent.toLowerCase();
      
      for (var k = 0; k < inputList.length; k++) {
        var filterValue = inputList[k].toLowerCase();
        if (tagName === filterValue) {
          isMatch = true;
          break;
        }
      }

      if (isMatch) {
        tile.style.display = 'flex'; // Show the tile
      } else {
        tile.style.display = 'none'; // Hide the tile
      }
      
    }
    // Hide the tile if it doesn't have any tags
    if (tags.length === 0) {
      tile.style.display = 'none';
    }
  }
}

function showAllTiles(inputList) {
  var tiles = document.getElementsByClassName('tile');
  for (var i = 0; i < tiles.length; i++) {
    var tile = tiles[i];
    var tagsElement = tile.querySelector('.tags');
    var tags = tagsElement.querySelectorAll('span');

    var isMatch = false;
    for (var j = 0; j < tags.length; j++) {
      var tag = tags[j];
      var tagName = tag.textContent.toLowerCase();
      
      for (var k = 0; k < inputList.length; k++) {
        var filterValue = inputList[k].toLowerCase();
        if (tagName === filterValue) {
          isMatch = true;
          break;
        }
      }

      if (isMatch) {
        tile.style.display = 'block'; // Show the tile
      } else {
        tile.style.display = 'none'; // Hide the tile
      }
      
    }
    
  }
}

//loader
        document.onreadystatechange = function() {
        if (document.readyState !== "complete") {
            document.querySelector(
            "body").style.visibility = "hidden";
            document.querySelector(
            "#loader").style.visibility = "visible";
            setTimeout(function() {
        document.querySelector(
            "#loader").style.visibility = "visible";
        }, 2000);
        } else {
            document.querySelector(
            "#loader").style.display = "none";
            document.querySelector(
            "body").style.visibility = "visible";
        }
    };

   
    </script>
     

</body>
</html>
